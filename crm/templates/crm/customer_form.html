{% extends 'crm/crm_base.html' %}

{% load i18n %}

{% block page_title %}
    {% url 'customer_add_person' as add_customer %}
    {% url 'customer_add_organisation' as add_organisation %}
    {% if request.path == add_customer %}
        {% trans 'Add Customer' %}
    {% elif request.path == add_organisation %}
        {% trans 'Add Organisation' %}
    {% else %}
        {% blocktrans with name=object.name %}Edit {{ name }}{% endblocktrans %}
    {% endif %}
{% endblock %}

{% block content %}
    {% url 'customer_add_person' as add_customer %}
    {% url 'customer_add_organisation' as add_organisation %}
    <h2>
        {% if request.path == add_customer %}
            {% trans 'Add Customer' %}
        {% elif request.path == add_organisation %}
            {% trans 'Add Organisation' %}
        {% else %}
            {% blocktrans with name=object.name %}Edit {{ name }}{% endblocktrans %}
        {% endif %}
    </h2>

    <form action="" method="post">
        {% csrf_token %}
        {{ form.as_p }}

        <input type="submit" value="{% if request.path == add_customer %}{% trans 'Create customer' %}{% elif request.path == add_organisation %}{% trans 'Create organisation' %}{% else %}{% trans 'Save' %}{% endif %}" />
    </form>

    {% if request.path != add_customer and request.path != add_organisation %}
    <form action="{% url 'save_type_fields' object.get_type object.id %}" method="post">
        {% csrf_token %}
        <h3>{% trans 'Type fields' %}</h3>
        {# Render CustomerTypeFields #}
        {% if object.get_type_fields %}
        {% for type in object.get_type_fields.values %}
            <h4>{{ type.type }}</h4>
            {% for field in type.fields.values %}
            <label for="typefield_{{ type.type.id }}_{{ field.field.id }}">{{ field.field }}: </label>
            <input type="text" id="typefield_{{ type.type.id }}_{{ field.field.id }}" name="typefield_{{ type.type.id }}_{{ field.field.id }}" value="{{ field.value }}" /><br/>
            {% endfor %}
        {% endfor %}
        {% else %}
            <p>This customer has no type fields.</p>
        {% endif %}

        <input type="submit" value="{% trans 'Save type fields' %}" />
    </form>
    {% endif %}
{% endblock %}